# Versioning

This document explains the versioning system for wetwire-aws-go.

## Version Types

The project maintains **two independent version streams**:

| Version | Format | Purpose |
|---------|--------|---------|
| **Package Version** | Semantic (vX.Y.Z) | Git tags, releases, API changes |
| **CloudFormation Spec** | AWS version string | Track AWS spec updates |

### Package Version

The main version for releases. Follows [Semantic Versioning](https://semver.org/):

- **MAJOR** (X): Breaking API changes
- **MINOR** (Y): New features, backwards compatible
- **PATCH** (Z): Bug fixes, backwards compatible

**Location:** Git tags (e.g., `v1.7.0`)

**Detection:** Runtime via `debug.ReadBuildInfo()` or ldflags

### CloudFormation Spec Version

Tracks which AWS CloudFormation spec was used to generate resource classes.

**Source:** Fetched via `cloudformation-schema-go` package

**Location:** Embedded in generated file headers

---

## Generated Code Metadata

All generated resource files include version metadata in their headers:

```go
// Code generated by wetwire-aws codegen. DO NOT EDIT.
// Source: CloudFormation Resource Specification
// Generated: 2026-01-06T21:34:23-07:00
```

---

## Bumping the Package Version

When releasing a new version:

1. Update CHANGELOG.md with changes
2. Run tests:
   ```bash
   go test ./...
   ./scripts/ci.sh
   ```

3. Commit and tag:
   ```bash
   git commit -am "chore: release v1.8.0"
   git tag v1.8.0
   git push && git push --tags
   ```

The tag triggers the release workflow in GitHub Actions.

---

## Bumping the CloudFormation Spec

When AWS releases a new CloudFormation spec:

1. Run the regeneration:
   ```bash
   go run ./codegen --force
   ```

2. Verify generated code:
   ```bash
   go build ./...
   go test ./...
   ```

3. Update CHANGELOG.md with spec version

4. Commit with spec version in message:
   ```bash
   git commit -am "chore: regenerate from CloudFormation spec vXXX.X.X"
   ```

5. Tag a new release (usually minor bump)

---

## Viewing Current Versions

### From CLI

```bash
wetwire-aws version
# or
wetwire-aws --version
```

### From Go Code

```go
import "runtime/debug"

if info, ok := debug.ReadBuildInfo(); ok {
    fmt.Println(info.Main.Version)
}
```

### From Generated Files

Check the header of any generated resource file:

```bash
head -5 resources/s3/bucket.go
```

---

## Version Resolution

The CLI determines its version using this priority:

1. **ldflags**: If built with `-ldflags "-X main.version=v1.0.0"`
2. **Build info**: If installed via `go install @version`
3. **Default**: Returns `"dev"` for local development builds

```go
// From cmd/wetwire-aws/version.go
func getVersion() string {
    if version != "" {
        return version
    }
    if info, ok := debug.ReadBuildInfo(); ok {
        if info.Main.Version != "" && info.Main.Version != "(devel)" {
            return info.Main.Version
        }
    }
    return "dev"
}
```

---

## Release Process

1. **Update CHANGELOG.md**
   - Move items from `[Unreleased]` to new version section
   - Add release date

2. **Create release commit**
   ```bash
   git add CHANGELOG.md
   git commit -m "chore: release vX.Y.Z"
   ```

3. **Tag the release**
   ```bash
   git tag vX.Y.Z
   git push origin main --tags
   ```

4. **GitHub Actions** automatically:
   - Builds binaries for multiple platforms
   - Creates GitHub release
   - Users can install via `go install @vX.Y.Z`

---

## Version Compatibility

| wetwire-aws-go | Go Version | Dependencies |
|----------------|------------|--------------|
| 1.x | 1.21+ | cloudformation-schema-go 1.x |

---

## See Also

- [Developer Guide](DEVELOPERS.md) - Full development guide
- [Code Generation](CODEGEN.md) - Resource generation details
- [CHANGELOG.md](../CHANGELOG.md) - Release history
