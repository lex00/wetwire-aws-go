// Package sapprivatelinknohostedzone contains CloudFormation resources.
// Compute resources: EC2, Lambda, ECS, etc.
//
// Generated by wetwire-aws import.
package sapprivatelinknohostedzone

import (
	"github.com/lex00/cloudformation-schema-go/enums"
	"github.com/lex00/wetwire-aws-go/resources/lambda"
)

var ASCPrivateLinkLambdaFunctionVpcConfig = lambda.Function_VpcConfig{
	SecurityGroupIds: SecurityGroups,
	SubnetIds: Subnets,
}

var ASCPrivateLinkLambdaFunctionCode = lambda.Function_Code{
	ZipFile: `import boto3
import cfnresponse
import logging
def handler(event, context):
  print('Receive event: {} and context: {}'.format(str(event), str(context)))
  responseData = {}
  eventType = event['RequestType'].strip()
  props = event['ResourceProperties']
  try:
    if eventType in ('Create'):
      match props['Action']:
        case 'EnablePrivateDNS':
          dnsClient = boto3.client('route53')
          ec2Client = boto3.client('ec2')
          serviceId = props['ServiceId']
          domainName = props['DomainName']
          ec2Client.modify_vpc_endpoint_service_configuration(ServiceId=serviceId, PrivateDnsName=domainName)
          validationRecord = ec2Client.describe_vpc_endpoint_service_configurations(ServiceIds=[serviceId])['ServiceConfigurations'][0]['PrivateDnsNameConfiguration']
          responseData['validationRecord'] = validationRecord
        case _:
          raise Exception('Unsupported action')
    else:
      print('Skip on resource UPDATE and DELETE')
    cfnresponse.send(event, context, cfnresponse.SUCCESS, responseData)
  except Exception as e:
    logging.exception(e)
    cfnresponse.send(event, context, cfnresponse.FAILED, responseData)
`,
}

var ASCPrivateLinkLambdaFunction = lambda.Function{
	Code: ASCPrivateLinkLambdaFunctionCode,
	Description: "Lambda function to help with private link infrastructure setup",
	Handler: "index.handler",
	Role: ASCPrivateLinkLambdaRole.Arn,
	Runtime: enums.LambdaRuntimePython312,
	Timeout: 900,
	VpcConfig: &ASCPrivateLinkLambdaFunctionVpcConfig,
}
