// Package public_vpc contains CloudFormation resources.
// Network resources: VPC, Subnets, Load Balancers, CloudFront, etc.
//
// Generated by wetwire-aws import.
package public_vpc

import (
	"github.com/lex00/cloudformation-schema-go/enums"
	. "github.com/lex00/wetwire-aws-go/intrinsics"
	"github.com/lex00/wetwire-aws-go/resources/ec2"
	"github.com/lex00/wetwire-aws-go/resources/elasticloadbalancingv2"
)

var InternetGateway = ec2.InternetGateway{
}

var VPC = ec2.VPC{
	CidrBlock: FindInMap{"SubnetConfig", "VPC", "CIDR"},
	EnableDnsHostnames: true,
	EnableDnsSupport: true,
}

var DummyTargetGroupPublic = elasticloadbalancingv2.TargetGroup{
	HealthCheckIntervalSeconds: 6,
	HealthCheckPath: "/",
	HealthCheckProtocol: "HTTP",
	HealthCheckTimeoutSeconds: 5,
	HealthyThresholdCount: 2,
	Name: Join{"-", []any{
	AWS_STACK_NAME,
	"drop-1",
}},
	Port: 80,
	Protocol: enums.Elbv2ProtocolEnumHttp,
	UnhealthyThresholdCount: 2,
	VpcId: VPC,
}

var GatewayAttachement = ec2.VPCGatewayAttachment{
	InternetGatewayId: InternetGateway,
	VpcId: VPC,
}

var PublicLoadBalancerSGSecurityGroupIngress1 = ec2.SecurityGroup_Ingress{
	CidrIp: "0.0.0.0/0",
	IpProtocol: -1,
}

var PublicLoadBalancerSG = ec2.SecurityGroup{
	GroupDescription: "Access to the public facing load balancer",
	SecurityGroupIngress: List(PublicLoadBalancerSGSecurityGroupIngress1),
	VpcId: VPC,
}

var PublicRouteTable = ec2.RouteTable{
	VpcId: VPC,
}

var PublicRoute = ec2.Route{
	DestinationCidrBlock: "0.0.0.0/0",
	GatewayId: InternetGateway,
	RouteTableId: PublicRouteTable,
}

var PublicLoadBalancerListenerDefaultActionForward = elasticloadbalancingv2.Listener_Action{
	TargetGroupArn: DummyTargetGroupPublic,
	Type_: "forward",
}

var PublicLoadBalancerListener = elasticloadbalancingv2.Listener{
	DefaultActions: List(PublicLoadBalancerListenerDefaultActionForward),
	LoadBalancerArn: PublicLoadBalancer,
	Port: 80,
	Protocol: enums.Elbv2ProtocolEnumHttp,
}

var PublicSubnetTwoRouteTableAssociation = ec2.SubnetRouteTableAssociation{
	RouteTableId: PublicRouteTable,
	SubnetId: PublicSubnetTwo,
}

var PublicLoadBalancerLoadBalancerAttributeIdletimeouttimeoutse = elasticloadbalancingv2.LoadBalancer_LoadBalancerAttribute{
	Key: "idle_timeout.timeout_seconds",
	Value: "30",
}

var PublicLoadBalancer = elasticloadbalancingv2.LoadBalancer{
	LoadBalancerAttributes: List(PublicLoadBalancerLoadBalancerAttributeIdletimeouttimeoutse),
	Scheme: "internet-facing",
	SecurityGroups: []any{PublicLoadBalancerSG},
	Subnets: []any{PublicSubnetOne, PublicSubnetTwo},
}

var EcsSecurityGroupIngressFromSelf = ec2.SecurityGroupIngress{
	Description: "Ingress from other hosts in the same security group",
	GroupId: EcsHostSecurityGroup,
	IpProtocol: -1,
	SourceSecurityGroupId: EcsHostSecurityGroup,
}

var PublicSubnetOne = ec2.Subnet{
	AvailabilityZone: Select{0, GetAZs{"map[Ref:AWS::Region]"}},
	CidrBlock: FindInMap{"SubnetConfig", "PublicOne", "CIDR"},
	MapPublicIpOnLaunch: true,
	VpcId: VPC,
}

var PublicSubnetTwo = ec2.Subnet{
	AvailabilityZone: Select{1, GetAZs{"map[Ref:AWS::Region]"}},
	CidrBlock: FindInMap{"SubnetConfig", "PublicTwo", "CIDR"},
	MapPublicIpOnLaunch: true,
	VpcId: VPC,
}

var EcsHostSecurityGroup = ec2.SecurityGroup{
	GroupDescription: "Access to the ECS hosts that run containers",
	VpcId: VPC,
}

var EcsSecurityGroupIngressFromPublicALB = ec2.SecurityGroupIngress{
	Description: "Ingress from the public ALB",
	GroupId: EcsHostSecurityGroup,
	IpProtocol: -1,
	SourceSecurityGroupId: PublicLoadBalancerSG,
}

var PublicSubnetOneRouteTableAssociation = ec2.SubnetRouteTableAssociation{
	RouteTableId: PublicRouteTable,
	SubnetId: PublicSubnetOne,
}
