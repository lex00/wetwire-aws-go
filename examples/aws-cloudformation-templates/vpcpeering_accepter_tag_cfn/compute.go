// Package vpcpeering_accepter_tag_cfn contains CloudFormation resources.
// Compute resources: EC2, Lambda, ECS, etc.
//
// Generated by wetwire-aws import.
package vpcpeering_accepter_tag_cfn

import (
	"github.com/lex00/cloudformation-schema-go/enums"
	. "github.com/lex00/wetwire-aws-go/intrinsics"
	"github.com/lex00/wetwire-aws-go/resources/lambda"
)

var TagVpcPeeringConnectionsLambdaFunctionEnvironment = lambda.Function_Environment{
	Variables: Json{"LOG_LEVEL": LambdaLogLevel},
}

var TagVpcPeeringConnectionsLambdaFunctionCode = lambda.Function_Code{
	ZipFile: `import cfnresponse, json, os, logging, boto3

LOGGER = logging.getLogger()
LOGGER.setLevel(logging.INFO)

try:
  logging.getLogger("boto3").setLevel(logging.CRITICAL)

  # Process Environment Variables
  LOGGER.setLevel(os.environ.get("LOG_LEVEL", logging.ERROR))

  ec2_client = boto3.client("ec2")
except Exception as error:
  LOGGER.error(error)
  cfnresponse.send(event, context, cfnresponse.FAILED, {})
  raise


def apply_name_tag(resource, name):
  return ec2_client.create_tags(Resources=[resource], Tags=[{"Key": "Name", "Value": name}])


def delete_name_tag(resource):
  return ec2_client.delete_tags(Resources=[resource], Tags=[{"Key": "Name"}])


def handler(event, context):
  try:
    LOGGER.info(f"REQUEST RECEIVED: {json.dumps(event, default=str)}")
    response_data = {}
    physical_resource_id = event.get("PhysicalResourceId")
    resource = event["ResourceProperties"].get("Resource")
    name = event["ResourceProperties"].get("Name")

    if event.get("RequestType") in ["Create", "Update"]:
      response = apply_name_tag(resource, name)
      LOGGER.info(f"response = {json.dumps(response, default=str)}")
    if event.get("RequestType") == "Delete":
      response = delete_name_tag(resource)
      LOGGER.info(f"response = {json.dumps(response, default=str)}")

    LOGGER.info("Sending Custom Resource Response")
    cfnresponse.send(event, context, cfnresponse.SUCCESS, response_data, physical_resource_id)
    return
  except Exception as error:
    LOGGER.error(error)
    cfnresponse.send(event, context, cfnresponse.FAILED, {})
    return
`,
}

var TagVpcPeeringConnectionsLambdaFunction = lambda.Function{
	Code: TagVpcPeeringConnectionsLambdaFunctionCode,
	Environment: TagVpcPeeringConnectionsLambdaFunctionEnvironment,
	FunctionName: LambdaFunctionName,
	Handler: "index.handler",
	MemorySize: 128,
	Role: TagVpcPeeringConnectionsLambdaRole.Arn,
	Runtime: enums.LambdaRuntimePython312,
	Timeout: 120,
}
