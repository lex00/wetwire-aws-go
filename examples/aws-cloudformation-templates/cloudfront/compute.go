// Package cloudfront_stack contains CloudFormation resources.
// Compute resources: EC2, Lambda, ECS, etc.
//
// Generated by wetwire-aws import.
package cloudfront_stack

import (
	"github.com/lex00/cloudformation-schema-go/enums"
	. "github.com/lex00/wetwire-aws-go/intrinsics"
	"github.com/lex00/wetwire-aws-go/resources/ec2"
	"github.com/lex00/wetwire-aws-go/resources/lambda"
)

var EC2InstanceBlockDeviceMappingDevsda1Ebs = ec2.Instance_Ebs{
	VolumeSize: BootVolSize,
	VolumeType: BootVolType,
}

var EC2InstanceTagEnvironment = Tag{
	Key: "Environment",
	Value: Environment,
}

var EC2InstanceTagName = Tag{
	Key: "Name",
	Value: Sub{String: "${AppName}-${Environment}-ec2-instance"},
}

var EC2InstanceBlockDeviceMappingDevsda1 = ec2.Instance_BlockDeviceMapping{
	DeviceName: "/dev/sda1",
	Ebs: &EC2InstanceBlockDeviceMappingDevsda1Ebs,
}

var EC2Instance = ec2.Instance{
	BlockDeviceMappings: List(EC2InstanceBlockDeviceMappingDevsda1),
	ImageId: EC2ImageId,
	InstanceType: EC2InstanceType,
	KeyName: KeyPairName,
	SecurityGroupIds: Any(EC2InstanceSG, ALBExternalAccessSG),
	SubnetId: PublicSubnetId1,
	Tags: []any{EC2InstanceTagName, EC2InstanceTagEnvironment},
}

var LambdaEdgeFunctionCode = lambda.Function_Code{
	ZipFile: "'use strict';\n\n exports.handler = (event, context, callback) => {\n    console.log('Adding additional headers to CloudFront response.');\n\n    const response = event.Records[0].cf.response;\n    response.headers['strict-transport-security'] = [{\n    key: 'Strict-Transport-Security',\n    value: 'max-age=86400; includeSubdomains; preload',\n    }];\n    response.headers['x-content-type-options'] = [{\n    key: 'X-Content-Type-Options',\n    value: 'nosniff',\n    }];\n    response.headers['x-frame-options'] = [{\n        key:   'X-Frame-Options',\n        value: \"DENY\"\n    }];\n    response.headers['content-security-policy'] = [{\n        key:   'Content-Security-Policy',\n        value: \"default-src 'none'; img-src 'self'; script-src 'self'; style-src 'self'; object-src 'none'\"\n    }];\n    response.headers['x-xss-protection'] = [{\n        key:   'X-XSS-Protection',\n        value: \"1; mode=block\"\n    }];\n    response.headers['referrer-policy'] = [{\n        key:   'Referrer-Policy',\n        value: \"same-origin\"\n    }];\n    callback(null, response);\n  };\n",
}

var LambdaEdgeFunction = lambda.Function{
	Code: LambdaEdgeFunctionCode,
	Description: "A custom Lambda@Edge function for serving custom headers from CloudFront Distribution",
	FunctionName: Sub{String: "${AppName}-lambda-edge-${Environment}"},
	Handler: "index.handler",
	MemorySize: 128,
	Role: LambdaEdgeIAMRole.Arn,
	Runtime: enums.LambdaRuntimeNodejs20X,
	Timeout: 5,
}

var LambdaEdgeVersion = lambda.Version{
	FunctionName: LambdaEdgeFunction,
}
