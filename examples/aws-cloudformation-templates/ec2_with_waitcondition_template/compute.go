// Package ec2_with_waitcondition_template contains CloudFormation resources.
// Compute resources: EC2, Lambda, ECS, etc.
//
// Generated by wetwire-aws import.
package ec2_with_waitcondition_template

import (
	. "github.com/lex00/wetwire-aws-go/intrinsics"
	"github.com/lex00/wetwire-aws-go/resources/ec2"
)

var KWOSInstanceTagMasterID = Tag{
	Key: "MasterID",
	Value: MasterID,
}

var KWOSInstanceTagIsMaster = Tag{
	Key: "IsMaster",
	Value: IsMaster,
}

var KWOSInstanceTagAgentID = Tag{
	Key: "AgentID",
	Value: AgentID,
}

var KWOSInstanceTagTestTarget = Tag{
	Key: "TestTarget",
	Value: TestTarget,
}

var KWOSInstanceTagBudgetCode = Tag{
	Key: "BudgetCode",
	Value: BudgetCode,
}

var KWOSInstanceTagName = Tag{
	Key: "Name",
	Value: InstanceName,
}

var KWOSInstanceTagTestID = Tag{
	Key: "TestID",
	Value: TestID,
}

var KWOSInstanceTagLaunchUser = Tag{
	Key: "LaunchUser",
	Value: LaunchUser,
}

var KWOSInstanceTagLaunchPlatform = Tag{
	Key: "LaunchPlatform",
	Value: LaunchPlatform,
}

var KWOSInstance = ec2.Instance{
	ImageId: ImageId,
	InstanceType: InstanceType,
	KeyName: KeyName,
	Monitoring: false,
	SecurityGroupIds: Any(KWOSSecurityGroup),
	SubnetId: SubnetId,
	Tags: []any{KWOSInstanceTagLaunchPlatform, KWOSInstanceTagLaunchUser, KWOSInstanceTagTestID, KWOSInstanceTagName, KWOSInstanceTagBudgetCode, KWOSInstanceTagTestTarget, KWOSInstanceTagAgentID, KWOSInstanceTagIsMaster, KWOSInstanceTagMasterID},
	UserData: Base64{Join{Delimiter: "", Values: []any{
	"#!/bin/bash\n",
	"apt-get -y install python-pip\n",
	"pip install https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-latest.tar.gz\n",
	"# Helper function\n",
	"function error_exit\n",
	"{\n",
	"  /usr/local/bin/cfn-signal -e 1 -r \"$1\" '",
	KWOSWaitHandle,
	"'\n",
	"  exit 1\n",
	"}\n",
	"# Install the basic system configuration\n",
	"/usr/local/bin/cfn-init -s ",
	AWS_STACK_ID,
	" -r KWOSInstance ",
	"         --region ",
	AWS_REGION,
	" || error_exit 'Failed to run cfn-init'\n",
	"# All done so signal success\n",
	"/usr/local/bin/cfn-signal -e 0 -r \"KWOS setup complete\" '",
	KWOSWaitHandle,
	"'\n",
}}},
}
