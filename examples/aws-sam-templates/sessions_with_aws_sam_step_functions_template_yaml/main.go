// Package template contains CloudFormation resources.
// Main resources
//
// Generated by wetwire-aws import.
package template

import (
	. "github.com/lex00/wetwire-aws-go/intrinsics"
	"github.com/lex00/wetwire-aws-go/resources/serverless"
)

var AnalyticsTablePrimaryKey = serverless.SimpleTable_PrimaryKey{
	Name: "Id",
	Type_: "String",
}

var AnalyticsTable = serverless.SimpleTable{
	PrimaryKey: &AnalyticsTablePrimaryKey,
	ProvisionedThroughput: Json{
	"ReadCapacityUnits": 1,
	"WriteCapacityUnits": 1,
},
}

var GatherTwitchMetrics = serverless.StateMachine{
	DefinitionSubstitutions: Json{
	"DDBPutItem": Sub{String: "arn:${AWS::Partition}:states:::dynamodb:putItem"},
	"DDBTable": AnalyticsTable,
},
	DefinitionUri: "statemachine/twitch.asl.json",
	Policies: []any{Json{
	"DynamoDBWritePolicy": Json{
	"TableName": AnalyticsTable,
},
}},
	Type_: "EXPRESS",
}

var AnalyticsStateMachine = serverless.StateMachine{
	DefinitionSubstitutions: Json{
	"SNSTopicArn": AnalyticsTopic,
	"StackOverflowWorkflowArn": GatherStackOverflowMetrics,
	"TwitchWorkflowArn": GatherTwitchMetrics,
},
	DefinitionUri: "statemachine/analytics.asl.json",
	Events: Json{
	"DailySchedule": Json{
	"Properties": Json{
	"Description": "Schedule to run the analytics state machine every day",
	"Enabled": true,
	"Schedule": "rate(1 day)",
},
	"Type": "Schedule",
},
},
	Role: AnalyticsWorkflowRole.Arn,
}

var GatherStackOverflowMetrics = serverless.StateMachine{
	DefinitionSubstitutions: Json{
	"DDBPutItem": Sub{String: "arn:${AWS::Partition}:states:::dynamodb:putItem"},
	"DDBTable": AnalyticsTable,
},
	DefinitionUri: "statemachine/stackoverflow.asl.json",
	Policies: []any{Json{
	"DynamoDBWritePolicy": Json{
	"TableName": AnalyticsTable,
},
}},
	Type_: "EXPRESS",
}
