// Package template contains CloudFormation resources.
// Main resources
//
// Generated by wetwire-aws import.
package template

import (
	. "github.com/lex00/wetwire-aws-go/intrinsics"
	"github.com/lex00/wetwire-aws-go/resources/kinesisanalytics"
	"github.com/lex00/wetwire-aws-go/resources/serverless"
)

var CountTable = serverless.SimpleTable{
}

var CountFunctionEnvironment = serverless.Function_Environment{
	Variables: Json{"TABLE_NAME": CountTable},
}

var CountFunction = serverless.Function{
	CodeUri: "src/",
	Environment: &CountFunctionEnvironment,
	Handler: "count.handler",
	Policies: []any{Json{
	"DynamoDBCrudPolicy": Json{
	"TableName": CountTable,
},
}},
	Runtime: "nodejs16.x",
	Timeout: 180,
}

var KinesisAnalyticsAppInput1InputSchemaRecordFormat = kinesisanalytics.ApplicationReferenceDataSource_RecordFormat{
	RecordFormatType: "JSON",
}

var KinesisAnalyticsAppInput1InputSchemaRecordColumnResourcePath = kinesisanalytics.ApplicationReferenceDataSource_RecordColumn{
	Mapping: "$.resourcePath",
	Name: "resourcePath",
	SqlType: "varchar(16)",
}

var KinesisAnalyticsAppInput1InputSchemaRecordColumnStatus = kinesisanalytics.ApplicationReferenceDataSource_RecordColumn{
	Mapping: "$.status",
	Name: "status",
	SqlType: "varchar(8)",
}

var KinesisAnalyticsAppInput1InputSchemaRecordColumnIp = kinesisanalytics.ApplicationReferenceDataSource_RecordColumn{
	Mapping: "$.ip",
	Name: "ip",
	SqlType: "varchar(16)",
}

var KinesisAnalyticsAppInput1InputSchemaRecordColumnRequestId = kinesisanalytics.ApplicationReferenceDataSource_RecordColumn{
	Mapping: "$.requestId",
	Name: "requestId",
	SqlType: "bigint",
}

var KinesisAnalyticsAppInput1KinesisFirehoseInput = kinesisanalytics.Application_KinesisFirehoseInput{
	ResourceARN: Firehose.Arn,
	RoleARN: KinesisAnalyticsAccessRole.Arn,
}

var KinesisAnalyticsAppInput1InputSchema = kinesisanalytics.Application_InputSchema{
	RecordColumns: []any{KinesisAnalyticsAppInput1InputSchemaRecordColumnRequestId, KinesisAnalyticsAppInput1InputSchemaRecordColumnIp, KinesisAnalyticsAppInput1InputSchemaRecordColumnStatus, KinesisAnalyticsAppInput1InputSchemaRecordColumnResourcePath},
	RecordFormat: KinesisAnalyticsAppInput1InputSchemaRecordFormat,
}

var KinesisAnalyticsAppInput1 = kinesisanalytics.Application_Input{
	InputSchema: KinesisAnalyticsAppInput1InputSchema,
	KinesisFirehoseInput: &KinesisAnalyticsAppInput1KinesisFirehoseInput,
	NamePrefix: "SESSIONS_STREAM",
}

var KinesisAnalyticsApp = kinesisanalytics.Application{
	ApplicationCode: `CREATE OR REPLACE STREAM "LINK_STREAM" ("resourcePath" varchar(16), link_count INTEGER); CREATE OR REPLACE PUMP "STREAM_PUMP" AS INSERT INTO "LINK_STREAM" SELECT STREAM "resourcePath", COUNT(*) AS link_count
    FROM "SESSIONS_STREAM_001"
    GROUP BY "resourcePath", STEP("SESSIONS_STREAM_001".ROWTIME BY INTERVAL '10' SECOND);
`,
	Inputs: []any{KinesisAnalyticsAppInput1},
}

var ProcessFunctionEnvironment = serverless.Function_Environment{
	Variables: Json{"TABLE_NAME": ProcessedDataTable},
}

var ProcessFunction = serverless.Function{
	CodeUri: "src/",
	Environment: &ProcessFunctionEnvironment,
	Handler: "process.handler",
	Policies: []any{Json{
	"DynamoDBCrudPolicy": Json{
	"TableName": ProcessedDataTable,
},
}},
	Runtime: "nodejs16.x",
	Timeout: 180,
}

var KinesisAnalyticsOutputOutputLambdaOutput = kinesisanalytics.ApplicationOutput_LambdaOutput{
	ResourceARN: CountFunction.Arn,
	RoleARN: KinesisAnalyticsAccessRole.Arn,
}

var KinesisAnalyticsOutputOutputDestinationSchema = kinesisanalytics.ApplicationOutput_DestinationSchema{
	RecordFormatType: "JSON",
}

var KinesisAnalyticsOutputOutput = kinesisanalytics.ApplicationOutput_Output{
	DestinationSchema: KinesisAnalyticsOutputOutputDestinationSchema,
	LambdaOutput: &KinesisAnalyticsOutputOutputLambdaOutput,
	Name: "LINK_STREAM",
}

var KinesisAnalyticsOutput = kinesisanalytics.ApplicationOutput{
	ApplicationName: KinesisAnalyticsApp,
	Output: KinesisAnalyticsOutputOutput,
}
