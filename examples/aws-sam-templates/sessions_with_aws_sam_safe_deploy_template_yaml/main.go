// Package template contains CloudFormation resources.
// Main resources
//
// Generated by wetwire-aws import.
package template

import (
	. "github.com/lex00/wetwire-aws-go/intrinsics"
	"github.com/lex00/wetwire-aws-go/resources/serverless"
)

var BaseAPICorsConfiguration = serverless.HttpApi_CorsConfiguration{
	AllowMethods: []any{"GET"},
	AllowOrigins: []any{ClientDomains},
}

var BaseAPI = serverless.HttpApi{
	CorsConfiguration: BaseAPICorsConfiguration,
}

var BasePostFunctionDeploymentPreference = serverless.Function_DeploymentPreference{
	Enabled: false,
}

var BasePostFunction = serverless.Function{
	DeploymentPreference: BasePostFunctionDeploymentPreference,
	FunctionName: "CodeDeployHook_postTrafficHook1",
	Handler: "src/hooks/basepost.lambdaHandler",
	Policies: []any{Json{
	"Statement": []any{Json{
	"Action": []any{"codedeploy:PutLifecycleEventHookExecutionStatus"},
	"Effect": "Allow",
	"Resource": Sub{String: "arn:${AWS::Partition}:codedeploy:${AWS::Region}:${AWS::AccountId}:deploymentgroup:${ServerlessDeploymentApplication}/*"},
}},
	"Version": "2012-10-17",
}},
}

var ResourcesLayer = serverless.LayerVersion{
	CompatibleRuntimes: []any{"nodejs16.x"},
	ContentUri: "layer/",
	LayerName: "resources",
	LicenseInfo: "MIT",
	RetentionPolicy: "Retain",
}

var BaseFunctionDeploymentPreference = serverless.Function_DeploymentPreference{
	Hooks: Json{"PostTraffic": BasePostFunction, "PreTraffic": BasePreFunction},
	TriggerConfigurations: []any{Json{"TriggerEvents": []any{"DeploymentStart", "DeploymentSuccess", "DeploymentFailure", "DeploymentStop", "DeploymentRollback"}, "TriggerName": "BaseAlerts", "TriggerTargetArn": AlertTopic}},
	Type_: "AllAtOnce",
}

var BaseFunction = serverless.Function{
	AutoPublishAlias: "live",
	DeploymentPreference: BaseFunctionDeploymentPreference,
	Description: "Base lambda function",
	Events: Json{
	"ApiEvent": Json{
	"Properties": Json{
	"ApiId": BaseAPI,
	"Method": "GET",
	"Path": "/",
},
	"Type": "HttpApi",
},
},
	Handler: "src/base.lambdaHandler",
}

var BasePreFunctionEnvironment = serverless.Function_Environment{
	Variables: Json{"FUNCTION_VERSION": Ref{"BaseFunction.Version"}},
}

var BasePreFunctionDeploymentPreference = serverless.Function_DeploymentPreference{
	Enabled: false,
}

var BasePreFunction = serverless.Function{
	DeploymentPreference: BasePreFunctionDeploymentPreference,
	Environment: BasePreFunctionEnvironment,
	FunctionName: "CodeDeployHook_preTrafficHook1",
	Handler: "src/hooks/basepre.lambdaHandler",
	Policies: []any{Json{
	"Statement": []any{Json{
	"Action": []any{"codedeploy:PutLifecycleEventHookExecutionStatus"},
	"Effect": "Allow",
	"Resource": Sub{String: "arn:${AWS::Partition}:codedeploy:${AWS::Region}:${AWS::AccountId}:deploymentgroup:${ServerlessDeploymentApplication}/*"},
}},
	"Version": "2012-10-17",
}, Json{
	"Statement": []any{Json{
	"Action": []any{"lambda:InvokeFunction"},
	"Effect": "Allow",
	"Resource": SubWithMap{String: "${FunctionArn}:*", Variables: Json{
	"FunctionArn": BaseFunction.Arn,
}},
}},
	"Version": "2012-10-17",
}},
}
